{"ast":null,"code":"import _slicedToArray from \"/home/user/Desktop/react_board/boards/boards-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/home/user/Desktop/react_board/boards/boards-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport { useState, useCallback } from \"react\";\nimport { isFunction } from \"@rpldy/shared\";\nimport { useBatchStartListener } from \"@rpldy/shared-ui\";\nimport { PREVIEW_TYPES } from \"./consts\";\nimport { getWithMandatoryOptions, getFallbackUrlData, getFileObjectUrlByType } from \"./utils\";\n\nvar getFilePreviewUrl = function getFilePreviewUrl(file, options) {\n  var data = getFileObjectUrlByType(PREVIEW_TYPES.IMAGE, options.imageMimeTypes, options.maxPreviewImageSize || 0, file);\n\n  if (!data) {\n    data = getFileObjectUrlByType(PREVIEW_TYPES.VIDEO, options.videoMimeTypes, options.maxPreviewVideoSize || 0, file);\n  }\n\n  return data;\n};\n\nvar loadPreviewData = function loadPreviewData(item, options, previewComponentProps) {\n  var data,\n      props,\n      isFallback = false;\n\n  if (item.file) {\n    var file = item.file;\n    data = getFilePreviewUrl(item.file, options);\n\n    if (!data) {\n      data = getFallbackUrlData(options.fallbackUrl, file);\n      isFallback = true;\n    }\n  } else {\n    data = {\n      url: item.url,\n      name: item.url,\n      type: PREVIEW_TYPES.IMAGE\n    };\n  }\n\n  if (data) {\n    var _data = data,\n        url = _data.url,\n        type = _data.type;\n    props = isFunction(previewComponentProps) ? previewComponentProps(item, url, type) : previewComponentProps;\n  }\n\n  return data && _objectSpread(_objectSpread({}, data), {}, {\n    id: item.id,\n    isFallback: isFallback,\n    props: props\n  });\n};\n\nvar mergePreviewData = function mergePreviewData(prev, next) {\n  var newItems = []; //dedupe and merge new with existing\n\n  next.forEach(function (n) {\n    var existingIndex = prev.findIndex(function (p) {\n      return p.id === n.id;\n    });\n\n    if (~existingIndex) {\n      prev.splice(existingIndex, 1, n);\n    } else {\n      newItems.push(n);\n    }\n  });\n  return prev.concat(newItems);\n};\n\nexport default (function (props) {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      previews = _useState2[0],\n      setPreviews = _useState2[1];\n\n  var previewOptions = getWithMandatoryOptions(props);\n  var clearPreviews = useCallback(function () {\n    setPreviews([]);\n  }, []);\n  useBatchStartListener(function (batch) {\n    var items = previewOptions.loadFirstOnly ? batch.items.slice(0, 1) : batch.items;\n    var previewsData = items.map(function (item) {\n      return loadPreviewData(item, previewOptions, props.previewComponentProps);\n    }).filter(Boolean);\n    setPreviews(props.rememberPreviousBatches ? mergePreviewData(previews, previewsData) : previewsData);\n  });\n  return {\n    previews: previews,\n    clearPreviews: clearPreviews\n  };\n});","map":{"version":3,"sources":["/home/user/Desktop/react_board/boards/boards-ui/node_modules/@rpldy/upload-preview/lib/esm/usePreviewsLoader.js"],"names":["useState","useCallback","isFunction","useBatchStartListener","PREVIEW_TYPES","getWithMandatoryOptions","getFallbackUrlData","getFileObjectUrlByType","getFilePreviewUrl","file","options","data","IMAGE","imageMimeTypes","maxPreviewImageSize","VIDEO","videoMimeTypes","maxPreviewVideoSize","loadPreviewData","item","previewComponentProps","props","isFallback","fallbackUrl","url","name","type","id","mergePreviewData","prev","next","newItems","forEach","n","existingIndex","findIndex","p","splice","push","concat","previews","setPreviews","previewOptions","clearPreviews","batch","items","loadFirstOnly","slice","previewsData","map","filter","Boolean","rememberPreviousBatches"],"mappings":"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","sourcesContent":["import { useState, useCallback } from \"react\";\nimport { isFunction } from \"@rpldy/shared\";\nimport { useBatchStartListener } from \"@rpldy/shared-ui\";\nimport { PREVIEW_TYPES } from \"./consts\";\nimport { getWithMandatoryOptions, getFallbackUrlData, getFileObjectUrlByType } from \"./utils\";\n\nconst getFilePreviewUrl = (file, options) => {\n  let data = getFileObjectUrlByType(PREVIEW_TYPES.IMAGE, options.imageMimeTypes, options.maxPreviewImageSize || 0, file);\n\n  if (!data) {\n    data = getFileObjectUrlByType(PREVIEW_TYPES.VIDEO, options.videoMimeTypes, options.maxPreviewVideoSize || 0, file);\n  }\n\n  return data;\n};\n\nconst loadPreviewData = (item, options, previewComponentProps) => {\n  let data,\n      props,\n      isFallback = false;\n\n  if (item.file) {\n    const file = item.file;\n    data = getFilePreviewUrl(item.file, options);\n\n    if (!data) {\n      data = getFallbackUrlData(options.fallbackUrl, file);\n      isFallback = true;\n    }\n  } else {\n    data = {\n      url: item.url,\n      name: item.url,\n      type: PREVIEW_TYPES.IMAGE\n    };\n  }\n\n  if (data) {\n    const {\n      url,\n      type\n    } = data;\n    props = isFunction(previewComponentProps) ? previewComponentProps(item, url, type) : previewComponentProps;\n  }\n\n  return data && { ...data,\n    id: item.id,\n    isFallback,\n    props\n  };\n};\n\nconst mergePreviewData = (prev, next) => {\n  const newItems = []; //dedupe and merge new with existing\n\n  next.forEach(n => {\n    const existingIndex = prev.findIndex(p => p.id === n.id);\n\n    if (~existingIndex) {\n      prev.splice(existingIndex, 1, n);\n    } else {\n      newItems.push(n);\n    }\n  });\n  return prev.concat(newItems);\n};\n\nexport default (props => {\n  const [previews, setPreviews] = useState([]);\n  const previewOptions = getWithMandatoryOptions(props);\n  const clearPreviews = useCallback(() => {\n    setPreviews([]);\n  }, []);\n  useBatchStartListener(batch => {\n    const items = previewOptions.loadFirstOnly ? batch.items.slice(0, 1) : batch.items;\n    const previewsData = items.map(item => loadPreviewData(item, previewOptions, props.previewComponentProps)).filter(Boolean);\n    setPreviews(props.rememberPreviousBatches ? mergePreviewData(previews, previewsData) : previewsData);\n  });\n  return {\n    previews,\n    clearPreviews\n  };\n});"]},"metadata":{},"sourceType":"module"}